<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI ç”Ÿæ´»å°ç§˜æ›¸ Â· å…¨æ–¹ä½æ•¸ä½è¼”åŠ©</title>
    <style>
        /* é ˜è¢–æŒ‡å®šï¼šé»‘é‡‘æ­¦å™¨åº«é¢¨æ ¼ */
        body { background-color: #050505; color: #fff; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; margin: 0; display: flex; justify-content: center; min-height: 100vh; overflow-y: auto; padding-bottom: 50px; }
        .glow-box { position: relative; width: 92%; max-width: 420px; background: #000; border-radius: 25px; margin: 20px 0; border: 1px solid #333; box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); }
        .inner-content { background: linear-gradient(160deg, #151515 0%, #050505 100%); border-radius: 23px; padding: 25px; display: flex; flex-direction: column; }
        
        .hero-section { display: flex; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #444; padding-bottom: 20px; }
        .egg-container { width: 100px; height: 120px; flex-shrink: 0; }
        .egg-base { width: 100%; height: 100%; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; background: radial-gradient(circle at 30% 30%, #D4AF37, #8b6508); box-shadow: 0 0 10px #D4AF37; }
        
        .name-info { margin-left: 20px; }
        .rank-title { color: #D4AF37; font-size: 0.9rem; font-weight: bold; }
        .display-name { font-size: 1.8rem; color: #FFFFFF; font-weight: 900; margin: 5px 0; }
        .display-sc { color: #00E5FF; font-size: 1.1rem; font-weight: 900; }

        .data-card { background: rgba(255, 255, 255, 0.05); border: 1px solid #333; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #D4AF37; }
        .stat-label { color: #BBB; font-size: 0.85rem; display: block; margin-bottom: 5px; }
        .stat-value { color: #D4AF37; font-weight: bold; font-size: 1.2rem; }

        .hatch-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .hatch-bar-fill { height: 100%; background: linear-gradient(90deg, #D4AF37, #FFFACD); transition: width 1s ease; }

        .back-btn { background: linear-gradient(180deg, #D4AF37, #B8860B); color: #000; padding: 18px; text-align: center; text-decoration: none; border-radius: 12px; font-weight: bold; margin-top: 20px; display: block; }
        .footer { font-size: 0.75rem; color: #555; text-align: center; margin-top: 30px; letter-spacing: 1px; }
    </style>
</head>
<body>
    <div class="glow-box">
        <div class="inner-content">
            <div class="hero-section">
                <div class="egg-container">
                    <div class="egg-base"></div>
                </div>
                <div class="name-info">
                    <div id="userTitle" class="rank-title">æ•¸ä½é ˜è¢–</div>
                    <div id="real-name" class="display-name">é€£ç·šä¸­...</div>
                    <div id="scValue" class="display-sc">0 SC</div>
                </div>
            </div>

            <div class="data-card">
                <span class="stat-label">ğŸ£ å‰µå»ºæ•¸ä½åˆ†èº« Â· å­µåŒ–é€²åº¦</span>
                <span id="hatch-percent" style="color: #D4AF37; font-weight: bold;">4%</span>
                <div class="hatch-bar-bg"><div id="hatch-fill" class="hatch-bar-fill" style="width: 4%;"></div></div>
            </div>

            <div class="data-card">
                <span class="stat-label">ğŸ“ˆ æœ¬æœˆé è¨ˆå›é¥‹ (ç¬¬ä¸€ä»£ 4%)</span>
                <span id="est-income" class="stat-value">NT$ 0</span>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="data-card"><span class="stat-label">ğŸ§§ æ¨è–¦çé‡‘</span><span id="ref-bonus" class="stat-value">0</span></div>
                <div class="data-card"><span class="stat-label">ğŸ‘¥ åœ˜éšŠäººæ•¸</span><span id="group-total" class="stat-value">0</span></div>
            </div>

            <div class="data-card" style="border-left: 4px solid #00E5FF;">
                <span class="stat-label">ğŸ›¡ï¸ ç´¯ç©æˆ°åŠŸ PV</span>
                <span id="pv-total" class="stat-value" style="color: #00E5FF;">0 PV</span>
            </div>

            <a id="btn-back" href="#" class="back-btn">è¿”å›æŒ‡ä»¤å¤§å»³</a>
            <div class="footer">AI ç”Ÿæ´»å°ç§˜æ›¸ Â· æœ€çµ‚è§£é‡‹æ¬Šæ­¸ç³»çµ±æ ¸å¿ƒæ‰€æœ‰</div>
        </div>
    </div>

    <script>
        // ğŸ› ï¸ å›æ­¸æœ€ç©©å®šçš„ã€Œç´€éŒ„é»ã€é€šè¨Šæ¨¡å¼
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            if (userId) {
                document.getElementById('btn-back').href = "Lobby.html?id=" + userId;
                
                // æ ¸å¿ƒå°æ¥é»ï¼šèˆ‡ Code.gs æ¡æ‰‹
                google.script.run
                    .withSuccessHandler(function(res) {
                        if (res && res.success) {
                            // æ•¸æ“šå¡«å…¥
                            document.getElementById('real-name').innerText = res.name;
                            document.getElementById('userTitle').innerText = res.title || "æ•¸ä½å…¬æ°‘";
                            document.getElementById('scValue').innerText = (res.sc || 0) + " SC";
                            document.getElementById('est-income').innerText = "NT$ " + (res.income || 0).toLocaleString();
                            document.getElementById('ref-bonus').innerText = "NT$ " + (res.detail.referral || 0).toLocaleString();
                            document.getElementById('group-total').innerText = res.groupTotal || 0;
                            document.getElementById('pv-total').innerText = (res.detail.pvTotal || 0) + " PV";
                            
                            // é€²åº¦æ¢é‚è¼¯
                            let progress = Math.min(100, 4 + (res.groupTotal * 9.6));
                            document.getElementById('hatch-fill').style.width = progress + "%";
                            document.getElementById('hatch-percent').innerText = Math.round(progress) + "%";
                        } else {
                            document.getElementById('real-name').innerText = "è³‡æ–™è®€å–å¤±æ•—";
                        }
                    })
                    .withFailureHandler(function(err) {
                        document.getElementById('real-name').innerText = "é€šè¨Šç•°å¸¸";
                    })
                    .getLeaderData(userId); // ç¢ºä¿ Code.gs ä¸­æ­¤å‡½å¼åç¨±æ­£ç¢º
            }
        };
    </script>
</body>
</html>

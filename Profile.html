<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI é ˜è¢–å±¬æ€§é¢æ¿</title>
    <style>
        /* åŸºç¤ç‰ˆé¢æ¨£å¼ */
        body { background-color: #050505; color: #fff; font-family: 'PingFang TC', sans-serif; margin: 0; display: flex; justify-content: center; min-height: 100vh; overflow-y: auto; padding-bottom: 50px; }
        .glow-box { position: relative; width: 92%; max-width: 420px; background: #000; border-radius: 25px; margin: 20px 0; z-index: 1; border: 1px solid #333; }
        .inner-content { background: linear-gradient(160deg, #151515 0%, #050505 100%); border-radius: 23px; padding: 25px; display: flex; flex-direction: column; min-height: 750px; }
        .hero-section { display: flex; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #444; padding-bottom: 20px; }
        .egg-container { position: relative; width: 140px; height: 160px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; }
        .egg-base { width: 100px; height: 135px; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; position: relative; transition: all 1s ease; overflow: hidden; }
        .cracks { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://www.transparenttextures.com/patterns/cracked-paper.png'); opacity: 0; mix-blend-mode: multiply; pointer-events: none; }
        .name-info { margin-left: 15px; }
        
        .rank-title { color: #FFD700; font-size: 0.95rem; letter-spacing: 1px; font-weight: bold; text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); margin-bottom: 4px; }
        .display-name { font-size: 1.8rem; margin: 5px 0; color: #FFFFFF; font-weight: 900; }
        .display-sc { color: #00E5FF; font-size: 1.1rem; font-weight: 900; margin-top: 5px; text-shadow: 0 0 5px rgba(0, 229, 255, 0.5); }
        
        .stat-label { color: #BBB; font-size: 0.85rem; }
        .stat-value { color: #FFD700; font-weight: bold; font-size: 1.1rem; }
        .data-row { margin-bottom: 15px; background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; border-left: 3px solid #D4AF37; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: rgba(255, 255, 255, 0.03); border: 1px solid #333; padding: 12px; border-radius: 12px; }
        .hatch-section { margin-bottom: 25px; }
        .hatch-label { display: flex; justify-content: space-between; font-size: 0.8rem; color: #FFD700; margin-bottom: 8px; }
        .hatch-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 10px; overflow: hidden; }
        .hatch-bar-fill { height: 100%; background: linear-gradient(90deg, #FFD700, #FFFACD); box-shadow: 0 0 10px #FFD700; transition: width 2s ease; }
        .back-btn { background: linear-gradient(180deg, #D4AF37, #B8860B); color: #000; padding: 18px; text-align: center; text-decoration: none; margin-top: 20px; border-radius: 10px; font-weight: bold; display: block; }
        .footer { font-size: 0.7rem; color: #555; text-align: center; padding: 30px 0; }

        @keyframes awaken-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); filter: brightness(1.8) drop-shadow(0 0 30px #FFD700); }
            100% { transform: scale(1); }
        }
        @keyframes title-glow {
            from { text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
            to { text-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700; transform: scale(1.05); }
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div class="glow-box">
        <div class="inner-content">
            <div class="hero-section">
                <div class="egg-container">
                    <div id="dynamic-egg" class="egg-base"><div id="egg-cracks" class="cracks"></div></div>
                </div>
                <div class="name-info">
                    <div id="userTitle" class="rank-title">æ•¸ä½å…¬æ°‘</div>
                    <div id="real-name" class="display-name">è®€å–ä¸­...</div>
                    <div id="scValue" class="display-sc">0 SC</div>
                </div>
            </div>

            <div class="hatch-section">
                <div class="hatch-label"><span>ğŸ£ ç ´è›‹å­µåŒ–é€²åº¦</span><span id="hatch-percent">4%</span></div>
                <div class="hatch-bar-bg"><div id="hatch-fill" class="hatch-bar-fill" style="width: 4%;"></div></div>
            </div>

            <div class="data-row">
                <div style="display: flex; justify-content: space-between;">
                    <span class="stat-label">ğŸ“ˆ æœ¬æœˆé ä¼°æ”¶å…¥</span>
                    <span id="est-income" class="stat-value">NT$ 0</span>
                </div>
            </div>

            <div class="stat-grid">
                <div class="stat-card"><span class="stat-label">ğŸ§§ æ¨è–¦çé‡‘ (é™ç›´æ¨)</span><span id="referral-bonus" class="stat-value">NT$ 0</span></div>
                <div class="stat-card"><span class="stat-label">ğŸ‘¥ 7ä»£å°çµ„ç¸½æ•¸</span><span id="group-total" class="stat-value">0</span></div>
            </div>

            <div class="stat-card" style="margin-top:10px; border-left: 3px solid #00E5FF;">
                <span class="stat-label">ğŸ›¡ï¸ å€‹äººæˆ°åŠŸ PV ç´¯ç©</span>
                <span id="pv-total" class="stat-value">0 PV</span>
            </div>

            <a id="btn-back" href="Lobby.html" class="back-btn">è¿”å› AI æŒ‡ä»¤å¤§å»³</a>
            <div class="footer">AI ç”Ÿæ´»å°ç§˜æ›¸ Â· æœ€çµ‚è§£é‡‹æ¬Šæ­¸ç³»çµ±æ ¸å¿ƒæ‰€æœ‰</div>
        </div>

        <div id="awaken-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:9999; justify-content:center; align-items:center; flex-direction:column; padding:20px; box-sizing:border-box; animation: fadeIn 1s ease;">
            <div id="capture-area" style="width:100%; max-width:380px; background:linear-gradient(135deg, #1a1a1a 0%, #000 100%); border:3px solid #FFD700; border-radius:30px; padding:30px; text-align:center; position:relative; box-shadow: 0 0 50px rgba(255, 214, 0, 0.5);">
                <div style="position:absolute; top:-40px; left:50%; transform:translateX(-50%); font-size:50px;">ğŸ‘‘</div>
                <h2 style="color:#FFD700; margin-bottom:5px; letter-spacing:3px;">å…¨æœå…¬å‘Š</h2>
                <div style="color:#00E5FF; font-weight:bold; margin-bottom:20px;">AI æ•¸ä½è»åœ˜ Â· é ˜è¢–è¦ºé†’</div>
                <div id="modal-title-display" style="background:#FFD700; color:#000; display:inline-block; padding:5px 15px; border-radius:20px; font-weight:900; font-size:18px; margin-bottom:20px;">ğŸ”¥ è¦ºé†’ Â· æˆ°éšŠå®—å¸«</div>
                <div style="font-size:24px; font-weight:900; color:#fff; margin-bottom:10px;" id="report-name">é ˜è¢–å§“å</div>
                <div style="border-top:1px solid #444; padding-top:20px;">
                    <div style="font-size:12px; color:#aaa;">è»åœ˜æˆ°åŠ› PV å·²é”æ¨™</div>
                    <div style="font-size:24px; color:#FFD700; font-weight:bold;"><span id="report-pv">0</span> PV</div>
                </div>
                <div style="margin-top:25px; background:#fff; padding:10px; display:inline-block; border-radius:10px;">
                    <img id="share-qr" src="" style="width:120px; height:120px;" alt="QR">
                </div>
                <div style="color:#fff; font-size:12px; margin-top:10px; opacity:0.7;">æƒæäºŒç¶­ç¢¼ Â· é ˜å– 50 å…ƒè³¼ç‰©é‡‘</div>
            </div>
            <button onclick="document.getElementById('awaken-modal').style.display='none'" style="margin-top:30px; background:transparent; border:1px solid #fff; color:#fff; padding:10px 30px; border-radius:20px; cursor:pointer;">è¿”å›é¢æ¿</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id'); 
            if (userId) {
                document.getElementById('btn-back').href = "Lobby.html?id=" + encodeURIComponent(userId);
                fetchData(userId);
            }
            updateEggVisuals();
        };

        function fetchData(id) {
            console.log("ğŸš€ å…§éƒ¨å°ˆç·šé€£çµä¸­...");
            google.script.run
                .withSuccessHandler(function(res) {
                    if (res && res.success) {
                        document.getElementById('real-name').innerText = res.name || "é ˜è¢–è³‡æ–™æ›´æ–°ä¸­";
                        document.getElementById('userTitle').innerText = res.title || "æ•¸ä½å…¬æ°‘";
                        document.getElementById('scValue').innerText = (res.sc || "0") + " SC";
                        if(res.detail) {
                            document.getElementById('est-income').innerText = "NT$ " + Math.round(res.income || 0).toLocaleString();
                            document.getElementById('referral-bonus').innerText = "NT$ " + (res.detail.referral || 0).toLocaleString();
                            document.getElementById('pv-total').innerText = (res.detail.pvTotal || 0) + " PV";
                        }
                        document.getElementById('group-total').innerText = res.groupTotal || 0;
                        let hatchProgress = Math.min(100, 4 + ((res.groupTotal || 0) * 9.6));
                        updateHatch(hatchProgress);
                        if(res.groupTotal >= 10) handleAwaken(res, id);
                    }
                })
                .withFailureHandler(function(err) { console.error("âŒ é€£ç·šç•°å¸¸:", err); })
                .getLeaderData(id);
        }

        function handleAwaken(res, id) {
            const egg = document.getElementById('dynamic-egg');
            const rankTitle = document.getElementById('userTitle');
            if (egg) egg.style.animation = "awaken-pulse 1.5s infinite";
            if (rankTitle) rankTitle.style.animation = "title-glow 1s ease-in-out infinite alternate";
            const modal = document.getElementById('awaken-modal');
            if (modal && modal.style.display !== 'flex') {
                modal.style.display = 'flex';
                document.getElementById('report-name').innerText = res.name;
                document.getElementById('report-pv').innerText = res.detail.pvTotal;
                document.getElementById('modal-title-display').innerText = "ğŸ”¥ è¦ºé†’ Â· " + res.title;
                document.getElementById('share-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(window.location.href)}`;
            }
        }

        function updateHatch(progress) {
            const rounded = Math.round(progress);
            document.getElementById('hatch-fill').style.width = rounded + "%";
            document.getElementById('hatch-percent').innerText = rounded + "%";
            const cracks = document.getElementById('egg-cracks');
            if (cracks) cracks.style.opacity = (rounded / 100).toString();
        }

        function updateEggVisuals() {
            const hour = new Date().getHours();
            const egg = document.getElementById('dynamic-egg');
            if (hour >= 6 && hour < 18) {
                egg.style.background = "radial-gradient(circle at 20% 20%, #ffffff 0%, #fff0b3 20%, #d4af37 60%, #8b6508 100%)";
            } else {
                egg.style.background = "radial-gradient(circle at 80% 20%, #e0e0e0 0%, #707070 30%, #202020 80%, #000000 100%)";
            }
        }
    </script>
</body>
</html>
